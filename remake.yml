# This file is automatically generated from remake_data.yml.whisker:
# edit the file there (or the files that it includes).
packages:
  - austraits.build

targets:
  all:
    depends:
      - austraits
      - export/data/curr/austraits.rds

  export/data/curr/austraits.rds:
    command: saveRDS(austraits_versioned, target_name)

  version_number:
    command: desc_get_version("./DESCRIPTION")
    
  git_SHA:
    command: get_SHA()
    depends:
      - .git/index  

  schema:
    command: load_schema()

  traits_definitions:
    command: load_schema("config/traits.yml", I("traits"))

  unit_conversions:
    command: make_unit_conversion_functions("config/unit_conversions.csv")

  taxon_list:
    command: read_csv_char("config/taxon_list.csv")

  Falster_2003_config:
    command: >
      subset_config("data/Falster_2003/metadata.yml",
                 traits_definitions,
                 unit_conversions
                 )
  Falster_2003:
    command: >
      load_dataset("data/Falster_2003/data.csv",
                  Falster_2003_config,
                  schema
                 )

  Falster_2005_1_config:
    command: >
      subset_config("data/Falster_2005_1/metadata.yml",
                 traits_definitions,
                 unit_conversions
                 )
  Falster_2005_1:
    command: >
      load_dataset("data/Falster_2005_1/data.csv",
                  Falster_2005_1_config,
                  schema
                 )


  austraits_raw:
    command: >
      combine_datasets(
        Falster_2003,
        Falster_2005_1,
        NULL)

  austraits:
    command: update_taxonomy(austraits_raw, taxon_list)
    
  austraits_versioned:
    command: add_version_info(austraits, version_number, git_SHA)
